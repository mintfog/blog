<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><title>Elasticsearch å…¨æ–‡æœç´¢å¼•æ“åŸºæœ¬ä½¿ç”¨</title><meta name="keywords" content="es,elasticsearch,å…¨æ–‡æœç´¢,elasticsearch 7,elasticsearch 8,åˆ†é¢æœç´¢,åŒä¹‰è¯æœç´¢,ç›¸ä¼¼æ¨è,ç”µå•†æœç´¢,æœç´¢å¼•æ“"><meta name="description" content="elasticsearch 8å…¨æ–‡æœç´¢ä¸åˆ†é¢æœç´¢, å¸¸è§çš„ç”µå•†æœç´¢æ–¹æ¡ˆï¼ŒåŒä¹‰è¯æœç´¢ï¼Œåˆ†é¢æœç´¢ï¼Œç›¸ä¼¼å•†å“æ¨èï¼Œphpä½¿ç”¨elasticsearchï¼Œlaravelä½¿ç”¨elasticsearch"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/style/main.css"><link rel="stylesheet" href="/style/jquery.fancybox.min.css"><link rel="stylesheet" href="/style/gitalk.css"><script async src="https://www.googletagmanager.com/gtag/js?id=G-2GM6102E19"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2GM6102E19")</script><link rel="alternate" href="/atom.xml" title="codeover" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="codeover" type="application/rss+xml"></head><body><div id="app" class="main"><div class="site-header-container"><div class="site-header"><div class="left"> <a href="https://www.codeover.cn"><img class="avatar" src="/images/avatar.png" alt="" width="32px" height="32px"></a><a href="https://www.codeover.cn"><h1 class="site-title">codeover</h1></a></div><div class="right"><i class="icon menu-switch icon-menu-outline"></i></div></div></div><div class="menu-container" style="height:0;opacity:0"><nav class="menu-list"> <a href="/" class="menu purple-link">é¦–é¡µ</a> <a href="/tags/" class="menu purple-link">æ ‡ç­¾</a> <a href="/categories/" class="menu purple-link">åˆ†ç±»</a> <a href="/archives/" class="menu purple-link">å½’æ¡£</a> <a href="/about/" class="menu purple-link">å…³äº</a></nav></div><div class="content-container"><div class="post-detail"><h2 class="post-title">Elasticsearch å…¨æ–‡æœç´¢å¼•æ“åŸºæœ¬ä½¿ç”¨</h2><div class="post-info post-detail-info"><span><i class="icon icon-calendar-outline"></i> 2022-07-24</span><span><i class="icon icon-pricetags-outline"></i> <a href="/tags/php/">php ï¼Œ</a> <a href="/tags/laravel/">laravel ï¼Œ</a> <a href="/tags/es/">es</a></span></div><div class="post-content-wrapper"><div class="post-content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æœç´¢å’Œåˆ†æå¼•æ“ï¼Œå¯ä»¥ç”¨äºå…¨æ–‡æ£€ç´¢ã€ç»“æ„åŒ–æ£€ç´¢å’Œåˆ†æï¼Œå¹¶èƒ½å°†è¿™ä¸‰è€…ç»“åˆèµ·æ¥ã€‚Elasticsearch åŸºäº Lucene å¼€å‘ï¼Œæ˜¯ Lucene çš„å°è£…ï¼Œæä¾›äº† REST API çš„æ“ä½œæ¥å£ï¼Œå¼€ç®±å³ç”¨ã€‚ç°åœ¨æ˜¯ä½¿ç”¨æœ€å¹¿çš„å¼€æºæœç´¢å¼•æ“ä¹‹ä¸€ï¼ŒWikipediaã€Stack Overflowã€GitHub ç­‰éƒ½åŸºäº Elasticsearch æ¥æ„å»ºä»–ä»¬çš„æœç´¢å¼•æ“ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>Elasticsearch å®‰è£…ç›¸å¯¹ç®€å•ï¼Œåªéœ€å®‰è£… JDK<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="JDK å…¨ç§° **Java Development Kit**ã€‚å®ƒæ˜¯ Java è¯­è¨€çš„è½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼Œä¸»è¦ç”¨äºç§»åŠ¨è®¾å¤‡ã€åµŒå…¥å¼è®¾å¤‡ä¸Šçš„ java åº”ç”¨ç¨‹åºã€‚JDK æ˜¯æ•´ä¸ª java å¼€å‘çš„æ ¸å¿ƒï¼Œå®ƒåŒ…å«äº† JAVA çš„è¿è¡Œç¯å¢ƒï¼ˆJVM+Java ç³»ç»Ÿç±»åº“ï¼‰å’Œ JAVA å·¥å…·ã€‚
">[1]</span></a></sup> ä¸‹è½½è§£å‹å³å¯ä½¿ç”¨ã€‚</p><h3 id="å®‰è£…-JDK"><a href="#å®‰è£…-JDK" class="headerlink" title="å®‰è£… JDK"></a>å®‰è£… JDK</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">yum install java-1.8.0-openjdk <span class="comment"># ğŸ‘ˆ CentOs</span></span><br><span class="line"></span><br><span class="line">apt-get install openjdk-8-jdk <span class="comment"># ğŸ‘ˆ Ubuntu</span></span><br></pre></td></tr></tbody></table></figure><p>ä¸‹è½½å®Œåè¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">java -version </span><br><span class="line"><span class="comment"># openjdk version "1.8.0_312"</span></span><br><span class="line"><span class="comment"># OpenJDK Runtime Environment (build 1.8.0_312-b07)</span></span><br><span class="line"><span class="comment"># OpenJDK 64-Bit Server VM (build 25.312-b07, mixed mode)</span></span><br></pre></td></tr></tbody></table></figure><h3 id="ä¸‹è½½å¹¶å®‰è£…-Elasticsearch"><a href="#ä¸‹è½½å¹¶å®‰è£…-Elasticsearch" class="headerlink" title="ä¸‹è½½å¹¶å®‰è£… Elasticsearch"></a>ä¸‹è½½å¹¶å®‰è£… Elasticsearch</h3><ul><li><p>æ‰“å¼€ç½‘å€ï¼š<a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/past-releases#elasticsearch">https://www.elastic.co/cn/downloads/past-releases#elasticsearch</a></p></li><li><p>é€‰æ‹©é€‚åˆçš„ç‰ˆæœ¬ç‚¹å‡» Download æŒ‰é’®ï¼Œæœ¬æ–‡é€‰æ‹©å®‰è£… 8.2.3 ç‰ˆæœ¬ã€Œæˆªæ­¢å‘æ–‡ ik æ’ä»¶æœ€æ–°ç‰ˆä¸º 8.2.3ã€</p><p><img src="https://cdn.codeover.cn/img/image-20220724220810173.png-imageFop" alt="ä¸‹è½½æµç¨‹"></p></li><li><p>é€‰æ‹© LINUX X86_64 å³é”®ç‚¹å‡»å¤åˆ¶é“¾æ¥</p><p><img src="https://cdn.codeover.cn/img/image-20220724221803766.png-imageFop" alt="å¤åˆ¶é“¾æ¥æˆªå›¾"></p></li><li><p>ä½¿ç”¨ <code>wget</code> å‘½ä»¤ä¸‹è½½å¹¶è§£å‹åˆ°ä½ å–œæ¬¢çš„è·¯å¾„</p><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æ­¤è¿‡ç¨‹åœ¨å›½å†…æœåŠ¡å™¨è¾ƒä¸ºç¼“æ…¢</span></span><br><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.2.3-linux-x86_64.tar.gz -O elasticsearch.tar.gz</span><br><span class="line">tar -zxvf elasticsearch.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°† elasticsearch ç§»åŠ¨åˆ° elasticsearch ç›®å½•</span></span><br><span class="line"><span class="built_in">mv</span> elasticsearch /www/server/elasticsearch</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><p>Elasticsearch ä¸å¯ä»¥ä½¿ç”¨ root ç”¨æˆ·è¿è¡Œï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å‰éœ€è¦åˆ‡æ¢è‡³æ™®é€šç”¨æˆ·ï¼Œå¹¶èµ‹äºˆè¯¥ç”¨æˆ·å¯¹åº”å‘½ä»¤çš„æ‰§è¡Œæƒé™</p><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">/www/server/elasticsearch/bin/elasticsearch -d</span><br></pre></td></tr></tbody></table></figure><h3 id="è¿æ¥æµ‹è¯•"><a href="#è¿æ¥æµ‹è¯•" class="headerlink" title="è¿æ¥æµ‹è¯•"></a>è¿æ¥æµ‹è¯•</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">curl <span class="string">'http://localhost:9200/?pretty'</span></span><br></pre></td></tr></tbody></table></figure><p>å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå°†ä¼šè¿”å›ç±»ä¼¼å¦‚ä¸‹æ ¼å¼å†…å®¹</p><figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span> <span class="punctuation">:</span> <span class="string">"VM-12-15-centos"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"cluster_name"</span> <span class="punctuation">:</span> <span class="string">"elasticsearch"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"cluster_uuid"</span> <span class="punctuation">:</span> <span class="string">"pYjA-9oFTpGhS295HBxpOg"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"version"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"number"</span> <span class="punctuation">:</span> <span class="string">"8.2.3"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"build_flavor"</span> <span class="punctuation">:</span> <span class="string">"default"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"build_type"</span> <span class="punctuation">:</span> <span class="string">"tar"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"build_hash"</span> <span class="punctuation">:</span> <span class="string">"9905bfb62a3f0b044948376b4f607f70a8a151b4"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"build_date"</span> <span class="punctuation">:</span> <span class="string">"2022-06-08T22:21:36.455508792Z"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"build_snapshot"</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"lucene_version"</span> <span class="punctuation">:</span> <span class="string">"9.1.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"minimum_wire_compatibility_version"</span> <span class="punctuation">:</span> <span class="string">"7.17.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"minimum_index_compatibility_version"</span> <span class="punctuation">:</span> <span class="string">"7.0.0"</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"tagline"</span> <span class="punctuation">:</span> <span class="string">"You Know, for Search"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><p>å¦‚æœé‡åˆ°æŠ¥é”™ï¼Œæ˜¯å› ä¸º Elasticsearch 8 é»˜è®¤å¼€å¯äº† X-Pack<sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="x-pack æ˜¯ elasticsearch çš„ä¸€ä¸ªæ‰©å±•åŒ…ï¼Œé›†å®‰å…¨ï¼Œè­¦å‘Šï¼Œç›‘è§†ï¼Œå›¾å½¢å’ŒæŠ¥å‘ŠåŠŸèƒ½äºä¸€ä½“ï¼Œå¯ä»¥è½»æ¾çš„å¯ç”¨æˆ–è€…å…³é—­ä¸€äº›åŠŸèƒ½ã€‚">[2]</span></a></sup>ï¼Œå› å…¶ä¸åœ¨æœ¬æ–‡çš„è®¨è®ºèŒƒå›´ï¼Œæ•…ç°å°†å…¶å…³é—­ï¼Œç¼–è¾‘æ–‡ä»¶ <code>config/elasticsearch.yml</code> åœ¨ 98 è¡Œå·¦å³å°† <code>xpack.security.enabled: false</code> ä¿®æ”¹ä¸º <code>false</code>ï¼Œå¦‚å›¾</p><p><img src="https://cdn.codeover.cn/img/image-20220724233806934.png-imageFop" alt="ä¿®æ”¹é…ç½®"></p><h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><p>Elasticsearch æ˜¯ä¸€ä¸ªåŸºäºæ–‡æ¡£çš„ NoSQL æ•°æ®åº“ï¼Œæ˜¯ä¸€ä¸ª <code>åˆ†å¸ƒå¼</code>ã€<code>RESTful</code>é£æ ¼çš„æœç´¢å’Œæ•°æ®åˆ†æå¼•æ“ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ <code>Elastic Stack</code> çš„æ ¸å¿ƒï¼Œé›†ä¸­å­˜å‚¨æ•°æ®ã€‚Elasticsearchã€Logstashã€Kibana ç»å¸¸è¢«ç”¨ä½œæ—¥å¿—åˆ†æç³»ç»Ÿï¼Œä¿—ç§° ELKã€‚</p><p>è¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªæ•°æ®åº“ï¼Œæ—¢ç„¶æ˜¯æ•°æ®åº“ï¼Œæœ‰ä¸€äº›æ¦‚å¿µæ˜¯äº’é€šçš„ï¼Œå¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>MySQL</th><th>Elasticsearch</th></tr></thead><tbody><tr><td>è¡¨ï¼ˆTableï¼‰</td><td>ç´¢å¼•ï¼ˆIndexï¼‰</td></tr><tr><td>è®°å½•ï¼ˆRowï¼‰</td><td>æ–‡æ¡£ï¼ˆDocumentï¼‰</td></tr><tr><td>å­—æ®µï¼ˆColumnï¼‰</td><td>å­—æ®µï¼ˆFieldsï¼‰</td></tr></tbody></table><h3 id="åŸºç¡€æ“ä½œ"><a href="#åŸºç¡€æ“ä½œ" class="headerlink" title="åŸºç¡€æ“ä½œ"></a>åŸºç¡€æ“ä½œ</h3><p>ä»¥ä¸‹ä¸º Elasticsearch å¸¸ç”¨çš„ APIï¼Œå…¶ä¸­ <code>{index_name}</code> ä»£è¡¨è‡ªå®šä¹‰çš„ç´¢å¼•åç§°ï¼Œ<code>{id}</code> ä¸ºæ–‡æ¡£çš„ IDã€ŒElasticsearch çš„ ID å¹¶éè‡ªå¢ï¼Œæ‰€ä»¥éœ€è¦è‡ªè¡ŒæŒ‡å®šã€ã€‚Elasticsearch çš„è¿”å›å€¼æ˜¯ JSON æ ¼å¼ï¼Œåœ¨å¯¹åº”åœ°å€åæ·»åŠ  <code>?pretty</code> å³å¯è·å–æ ¼å¼åŒ–çš„ JSON å†…å®¹</p><table><thead><tr><th>è¯·æ±‚æ–¹å¼</th><th>è¯·æ±‚è·¯å¾„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>PUT</td><td><code>/{index_name}</code></td><td>åˆ›å»ºç´¢å¼•</td></tr><tr><td>GET</td><td><code>/{index_name}</code></td><td>æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯</td></tr><tr><td>PUT</td><td><code>/{index_name}/_mapping</code></td><td>ä¿®æ”¹ç´¢å¼•å­—æ®µ</td></tr><tr><td>PUT</td><td><code>{index_name}/_doc/{id}</code></td><td>åˆ›å»º\ç¼–è¾‘æ–‡æ¡£</td></tr><tr><td>DELETE</td><td><code>{index_name}/_doc/{id}</code></td><td>åˆ é™¤æ–‡æ¡£</td></tr><tr><td>GET</td><td><code>{index_name}/_doc/{id}</code></td><td>è¯»å–æ–‡æ¡£æ•°æ®</td></tr><tr><td>POST</td><td><code>{index_name}/_search</code></td><td>æœç´ æ•°æ®</td></tr></tbody></table><h4 id="åˆ›å»ºç´¢å¼•"><a href="#åˆ›å»ºç´¢å¼•" class="headerlink" title="åˆ›å»ºç´¢å¼•"></a>åˆ›å»ºç´¢å¼•</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -XPUT http://localhost:9200/test_index</span><br></pre></td></tr></tbody></table></figure><h4 id="æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯"><a href="#æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯"></a>æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl http://localhost:9200/test_index</span><br></pre></td></tr></tbody></table></figure><h4 id="ä¸ºç´¢å¼•åˆ›å»ºç±»å‹"><a href="#ä¸ºç´¢å¼•åˆ›å»ºç±»å‹" class="headerlink" title="ä¸ºç´¢å¼•åˆ›å»ºç±»å‹"></a>ä¸ºç´¢å¼•åˆ›å»ºç±»å‹</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -H<span class="string">'Content-Type: application/json'</span> -XPUT http://localhost:9200/test_index/_mapping -d<span class="string">'{</span></span><br><span class="line"><span class="string">  "properties": {</span></span><br><span class="line"><span class="string">    "title": { "type": "text", "analyzer": "ik_smart" }, </span></span><br><span class="line"><span class="string">    "description": { "type": "text", "analyzer": "ik_smart" },</span></span><br><span class="line"><span class="string">    "price": { "type": "scaled_float", "scaling_factor": 100 }</span></span><br><span class="line"><span class="string">  }</span></span><br><span class="line"><span class="string">}'</span></span><br></pre></td></tr></tbody></table></figure><ul><li><code>properties</code> è¡¨ç¤ºè¿™ä¸ªç´¢å¼•ä¸­å„ä¸ªå­—æ®µçš„å®šä¹‰ï¼Œå…¶ä¸­ <code>key</code> æ˜¯å­—æ®µåç§°ï¼Œ<code>value</code> æ˜¯å­—æ®µçš„å®šä¹‰<ul><li><code>type</code> å®šä¹‰äº†å­—æ®µçš„æ•°æ®ç±»å‹ï¼Œå¸¸ç”¨çš„ç±»å‹æœ‰ <code>text</code> / <code>integer</code> / <code>date</code> / <code>boolean</code> / <code>keyword</code>ï¼Œå¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html">è¿™ä¸ªè¿æ¥</a> æŸ¥çœ‹æ‰€æœ‰ç±»å‹</li><li><code>analyzer</code> å‘Šè¯‰ Elasticsearch ä½¿ç”¨ä»€ä¹ˆæ–¹å¼ç»™è¿™ä¸ªå­—æ®µåˆ†è¯ï¼Œç¤ºä¾‹ä¸­ä½¿ç”¨äº† <code>ik_smart</code> ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸­æ–‡åˆ†è¯å™¨ï¼Œåæ–‡ä¼šæœ‰ä»‹ç»ã€‚</li></ul></li></ul><h4 id="åˆ›å»ºæ–‡æ¡£"><a href="#åˆ›å»ºæ–‡æ¡£" class="headerlink" title="åˆ›å»ºæ–‡æ¡£"></a>åˆ›å»ºæ–‡æ¡£</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -H<span class="string">'Content-Type: application/json'</span> -XPUT http://localhost:9200/test_index/_doc/1 -d<span class="string">'{</span></span><br><span class="line"><span class="string">    "title": "iPhone XR",</span></span><br><span class="line"><span class="string">    "description": "å…¨æ–°å›½äº§",</span></span><br><span class="line"><span class="string">    "price": 12800</span></span><br><span class="line"><span class="string">}'</span></span><br></pre></td></tr></tbody></table></figure><p>URL ä¸­çš„ <code>1</code> æ˜¯æ–‡æ¡£çš„ IDï¼Œè¿™ç‚¹å’Œ Mysql ä¸å¤ªä¸€æ ·ï¼ŒElasticsearch çš„æ–‡æ¡£ ID ä¸æ˜¯è‡ªå¢çš„ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šã€‚</p><h4 id="è¯»å–æ–‡æ¡£"><a href="#è¯»å–æ–‡æ¡£" class="headerlink" title="è¯»å–æ–‡æ¡£"></a>è¯»å–æ–‡æ¡£</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl http://localhost:9200/test_index/_doc/1</span><br></pre></td></tr></tbody></table></figure><p>URL ä¸­çš„ <code>1</code> å³åˆ›å»ºæ–‡æ¡£æ—¶çš„ID</p><h4 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -XPOST -H<span class="string">'Content-Type:application/json'</span> http://localhost:9200/test_index/_search?pretty -d<span class="string">'</span></span><br><span class="line"><span class="string">{</span></span><br><span class="line"><span class="string">    "query" : { "match" : { "description" : "å…¨æ–°" }}</span></span><br><span class="line"><span class="string">}'</span></span><br></pre></td></tr></tbody></table></figure><p>è¿”å›å†…å®¹</p><figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"took"</span> <span class="punctuation">:</span> <span class="number">201</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"timed_out"</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"_shards"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"total"</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"successful"</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"skipped"</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"failed"</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"hits"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"total"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"value"</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"relation"</span> <span class="punctuation">:</span> <span class="string">"eq"</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"max_score"</span> <span class="punctuation">:</span> <span class="number">0.6931471</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"hits"</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"_index"</span> <span class="punctuation">:</span> <span class="string">"test_index"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"_id"</span> <span class="punctuation">:</span> <span class="string">"1"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"_score"</span> <span class="punctuation">:</span> <span class="number">0.6931471</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"_source"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"title"</span> <span class="punctuation">:</span> <span class="string">"iPhone XR"</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">"description"</span> <span class="punctuation">:</span> <span class="string">"å…¨æ–°å›½äº§"</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">"price"</span> <span class="punctuation">:</span> <span class="number">12800</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><p><code>ik_smart</code> ä¼šæŠŠã€å…¨æ–°å›½äº§ã€åˆ†è¯æˆã€å…¨æ–°ã€å’Œã€å›½äº§ã€ä¸¤ä¸ªè¯ï¼Œå½“æˆ‘ä»¬ç”¨ <code>match</code> æ¥æœç´¢æ—¶ï¼ŒElasticsearch å°±ä¼šæ‹¿æœç´¢è¯åœ¨åˆ†è¯ç»“æœä¸­å¯»æ‰¾å®Œå…¨åŒ¹é…çš„æ–‡æ¡£ã€‚</p><h3 id="Elasticsearch-æŸ¥è¯¢"><a href="#Elasticsearch-æŸ¥è¯¢" class="headerlink" title="Elasticsearch æŸ¥è¯¢"></a>Elasticsearch æŸ¥è¯¢</h3><h4 id="å¸ƒå°”æŸ¥è¯¢"><a href="#å¸ƒå°”æŸ¥è¯¢" class="headerlink" title="å¸ƒå°”æŸ¥è¯¢"></a>å¸ƒå°”æŸ¥è¯¢</h4><p>Elasticsearch çš„å¸ƒå°”æŸ¥è¯¢ï¼ˆBool Queryï¼‰ä¸ SQL è¯­è¨€ä¸­çš„ <code>and</code> / <code>or</code> æœ‰äº›ç±»ä¼¼ï¼Œå¯ä»¥æ ¹æ®å¤šä¸ªæ¡ä»¶æ¥ç­›é€‰æ–‡æ¡£ã€‚</p><p>å¸ƒå°”æŸ¥è¯¢ä¸‹å¯ä»¥æœ‰ 4 ç±»æ¡ä»¶ï¼Œæ¯ä¸ªç±»æ¡ä»¶å¯¹åº”çš„é¡¹éƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å†…çš„æ¯ä¸ªé¡¹å¯¹åº”ä¸€ä¸ªæ¡ä»¶</p><ul><li><code>filter</code> ä¸ SQL è¯­å¥ä¸­çš„ <code>and</code> ç±»ä¼¼ï¼ŒæŸ¥è¯¢çš„æ–‡æ¡£å¿…é¡»åŒæ—¶æ»¡è¶³ç±»ä¸‹çš„æ‰€æœ‰æ¡ä»¶ã€‚</li><li><code>must</code> ä¸ <code>filter</code> ç›¸åŒï¼ŒåŒºåˆ«åœ¨äº <code>must</code> æ–¹æ³•ä¼šå‚ä¸ <em>æ‰“åˆ†</em>ï¼Œè€Œ <code>filter</code> ä¸ä¼šã€‚</li><li><code>should</code> æŸ¥è¯¢æ¡ä»¶ä¸éœ€å®Œå…¨æ»¡è¶³ï¼Œé»˜è®¤æƒ…å†µä¸‹åªéœ€è¦æ»¡è¶³ <code>should</code> ä¸‹çš„ä¸€é¡¹å³å¯ï¼Œå¯ä»¥é€šè¿‡ <code>minimum_should_match</code> å‚æ•°æ¥æ”¹å˜éœ€è¦æ»¡è¶³çš„ä¸ªæ•°ï¼Œæ»¡è¶³çš„æ¡ä»¶è¶Šå¤šå¯¹åº”æ–‡æ¡£çš„æ‰“åˆ†å°±è¶Šé«˜ã€‚</li><li><code>must_not</code> ä¸ <code>must</code> ç›¸åï¼ŒæŸ¥è¯¢çš„æ–‡æ¡£å¿…é¡»ä¸ç¬¦åˆæ­¤ç±»ä¸‹çš„æ‰€æœ‰æ¡ä»¶ã€‚</li></ul><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -XPOST -H<span class="string">'Content-Type:application/json'</span> http://localhost:9200/test_index/_search?pretty -d<span class="string">'</span></span><br><span class="line"><span class="string">{</span></span><br><span class="line"><span class="string">	"query": {</span></span><br><span class="line"><span class="string">		"bool": {</span></span><br><span class="line"><span class="string">			"filter": [{</span></span><br><span class="line"><span class="string">				"match": {</span></span><br><span class="line"><span class="string">					"description": "å…¨æ–°"</span></span><br><span class="line"><span class="string">				}</span></span><br><span class="line"><span class="string">			}, {</span></span><br><span class="line"><span class="string">				"match": {</span></span><br><span class="line"><span class="string">					"title": "iPhone"</span></span><br><span class="line"><span class="string">				}</span></span><br><span class="line"><span class="string">			}]</span></span><br><span class="line"><span class="string">		}</span></span><br><span class="line"><span class="string">	}</span></span><br><span class="line"><span class="string">}'</span></span><br></pre></td></tr></tbody></table></figure><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒæŸ¥è¯¢æ¡ä»¶å¿…é¡»åŒæ—¶æ»¡è¶³ <code>title</code> åŒ…å« <code>iPhone</code> ä¸” <code>description</code> åŒ…å« <code>å…¨æ–°</code></p><h4 id="åˆ†é¡µæŸ¥è¯¢"><a href="#åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="åˆ†é¡µæŸ¥è¯¢"></a>åˆ†é¡µæŸ¥è¯¢</h4><p>åˆ†é¡µæ˜¯æ•°æ®åº“æŸ¥è¯¢çš„ä¸€é¡¹éå¸¸é‡è¦çš„åŠŸèƒ½ï¼ŒElasticsearch æä¾›äº† <code>from</code> å’Œ <code>size</code> ä¸¤ä¸ªå‚æ•°ï¼Œå…¶å«ä¹‰ä¸ SQL è¯­å¥çš„ <code>limit $offset, $count</code> è¯­æ³•ä¸­çš„ <code>$offset</code> ä¸ <code>$count</code> å‚æ•°å®Œå…¨ä¸€è‡´ã€‚</p><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -XPOST -H<span class="string">'Content-Type:application/json'</span> http://localhost:9200/test_index/_search?pretty -d<span class="string">'</span></span><br><span class="line"><span class="string">{</span></span><br><span class="line"><span class="string">	"from": 0,</span></span><br><span class="line"><span class="string">	"size": 10,</span></span><br><span class="line"><span class="string">	"query": {</span></span><br><span class="line"><span class="string">		"bool": {</span></span><br><span class="line"><span class="string">			"filter": [{</span></span><br><span class="line"><span class="string">				"match": {</span></span><br><span class="line"><span class="string">					"description": "å…¨æ–°"</span></span><br><span class="line"><span class="string">				}</span></span><br><span class="line"><span class="string">			}]</span></span><br><span class="line"><span class="string">		}</span></span><br><span class="line"><span class="string">	}</span></span><br><span class="line"><span class="string">}'</span></span><br></pre></td></tr></tbody></table></figure><p>æ­¤ç¤ºä¾‹ä¸­ä»ç¬¬ 0 ä¸ªæ–‡æ¡£è·å–ï¼Œå…±è·å– 10 ä¸ªæ–‡æ¡£ï¼Œè¿”å›æ•°æ®ä¸­å¿ƒçš„ <code>$results['hits']['hits']</code> æ•°ç»„åŒ…å«äº†æ­¤æ¬¡æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£ï¼Œ<code>$results['hits']['total']['value']</code> åˆ™ä»£è¡¨æ•´ä¸ªç´¢å¼•ä¸­ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„æ–‡æ¡£æ•°é‡ã€‚</p><h4 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h4><p>Elasticsearch çš„æ’åºå¾ˆç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ª <code>sort</code> å‚æ•°ï¼Œ<code>sort</code> å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸‹çš„é¡¹å¯ä»¥æœ‰å¤šç§æ ¼å¼ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ ¼å¼æ˜¯ <code>key</code> <code>value</code> æ•°ç»„ï¼Œ<code>key</code> æ˜¯è¦æ’åºçš„å­—æ®µï¼Œ<code>value</code> å¯ä»¥æ˜¯ <code>desc</code> æˆ–è€… <code>asc</code>ã€‚</p><p>ç¤ºä¾‹</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -XPOST -H<span class="string">'Content-Type:application/json'</span> http://localhost:9200/test_index/_search?pretty -d<span class="string">'</span></span><br><span class="line"><span class="string">{</span></span><br><span class="line"><span class="string">	"from": 0,</span></span><br><span class="line"><span class="string">	"size": 10,</span></span><br><span class="line"><span class="string">    "sort": [{"price": "desc"}],</span></span><br><span class="line"><span class="string">	"query": {</span></span><br><span class="line"><span class="string">		"bool": {</span></span><br><span class="line"><span class="string">			"filter": [{</span></span><br><span class="line"><span class="string">				"match": {</span></span><br><span class="line"><span class="string">					"description": "å…¨æ–°"</span></span><br><span class="line"><span class="string">				}</span></span><br><span class="line"><span class="string">			}]</span></span><br><span class="line"><span class="string">		}</span></span><br><span class="line"><span class="string">	}</span></span><br><span class="line"><span class="string">}'</span></span><br></pre></td></tr></tbody></table></figure><p>è¯¥ç¤ºä¾‹ä½¿ç”¨ <code>price</code> å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åºã€‚</p><h4 id="å¤šå­—æ®µåŒ¹é…æŸ¥è¯¢"><a href="#å¤šå­—æ®µåŒ¹é…æŸ¥è¯¢" class="headerlink" title="å¤šå­—æ®µåŒ¹é…æŸ¥è¯¢"></a>å¤šå­—æ®µåŒ¹é…æŸ¥è¯¢</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -XPOST -H<span class="string">'Content-Type:application/json'</span> http://localhost:9200/test_index/_search?pretty -d<span class="string">'</span></span><br><span class="line"><span class="string">{</span></span><br><span class="line"><span class="string">	"from": 0,</span></span><br><span class="line"><span class="string">	"size": 10,</span></span><br><span class="line"><span class="string">    "sort": [{"price": "desc"}],</span></span><br><span class="line"><span class="string">	"query": {</span></span><br><span class="line"><span class="string">		"bool": {</span></span><br><span class="line"><span class="string">			"must": [{</span></span><br><span class="line"><span class="string">				"multi_match": {</span></span><br><span class="line"><span class="string">					"query": "å…¨æ–°",</span></span><br><span class="line"><span class="string">					"fields": ["title^2", "description"]</span></span><br><span class="line"><span class="string">				}</span></span><br><span class="line"><span class="string">			}]</span></span><br><span class="line"><span class="string">		}</span></span><br><span class="line"><span class="string">	}</span></span><br><span class="line"><span class="string">}'</span></span><br></pre></td></tr></tbody></table></figure><p>è¯¥ç¤ºä¾‹åŒæ—¶æœç´¢ <code>title</code> ä¸ <code>description</code> å­—æ®µï¼Œå…¶ä¸­ <code>title</code> å­—æ®µçš„æƒé‡ä¸º 2</p><h2 id="ä¸­æ–‡åˆ†è¯"><a href="#ä¸­æ–‡åˆ†è¯" class="headerlink" title="ä¸­æ–‡åˆ†è¯"></a>ä¸­æ–‡åˆ†è¯</h2><p>Elasticsearch é»˜è®¤æä¾›äº†ä¸€å †çš„åˆ†è¯å™¨ï¼Œæ¯”å¦‚ <code>standard</code>ã€<code>whitespace</code>ã€<code>language(æ¯”å¦‚english)</code> ç­‰åˆ†è¯å™¨ï¼Œä½†æ˜¯éƒ½å¯¹ä¸­æ–‡åˆ†è¯çš„æ•ˆæœä¸å¤ªå¥½ï¼Œä¸ºäº†å®ç°æ›´å¥½çš„æœç´¢æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹åˆ†è¯å™¨æ¥è¿›è¡Œåˆ†è¯ï¼Œæ¯”è¾ƒå¸¸è§çš„å°±æ˜¯ <code>ik</code> åˆ†è¯å™¨ã€‚</p><p><code>ik</code> åˆ†è¯å™¨çš„å®‰è£…æ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆå‰å¾€ github é€‰æ‹©ä¸ä½ çš„ Elasticsearch ç›¸åŒçš„ç‰ˆæœ¬ä¸‹è½½ï¼Œä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases</a>ï¼Œéšåè§£å‹è‡³ çš„ <code>plugins/ik/</code> ç›®å½•ä¸‹å³å¯ã€‚å¦‚ä¸‹ä¸‹è½½ 8.2.3 ç‰ˆæœ¬ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /www/server/elasticsearch/plugins</span><br><span class="line"><span class="built_in">mkdir</span> ik</span><br><span class="line"><span class="built_in">cd</span> ik</span><br><span class="line">wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v8.2.3/elasticsearch-analysis-ik-8.2.3.zip</span><br><span class="line">unzip elasticsearch-analysis-ik-8.2.3.zip</span><br><span class="line"><span class="built_in">rm</span> -f elasticsearch-analysis-ik-8.2.3.zip</span><br></pre></td></tr></tbody></table></figure><h2 id="åˆ†é¢æœç´¢"><a href="#åˆ†é¢æœç´¢" class="headerlink" title="åˆ†é¢æœç´¢"></a>åˆ†é¢æœç´¢</h2><p>æˆ‘ä»¬å¯ä»¥åœ¨äº¬ä¸œä¸Šæœç´¢ä¸€ä¸‹ã€æ‰‹æœºã€ï¼š</p><p><img src="https://cdn.codeover.cn/img/image-20220728220719329.png-imageFop" alt="äº¬ä¸œåˆ†é¢æœç´¢"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°äº¬ä¸œæŠŠä¸€äº›å±æ€§èšåˆåœ¨ä¸€èµ·å¹¶åšæˆäº†é“¾æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹å‡»èšåˆçš„é“¾æ¥è¿›ä¸€æ­¥çš„ç­›é€‰å•†å“ï¼Œè¿™ä¸ªåŠŸèƒ½å°±å«åšåˆ†é¢æœç´¢ï¼Œåˆ†é¢æœç´¢æ˜¯æœç´¢å¼•æ“ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·æ›´æ–¹ä¾¿çš„æœç´¢æƒ³è¦çš„å•†å“ã€‚</p><p>æƒ³è¦å®ç°åˆ†é¢æœç´¢å°±éœ€è¦ç”¨åˆ° Elasticsearch ä¸­çš„èšåˆï¼Œå…¶ä¸ SQL è¯­å¥çš„ <code>group by</code> æœ‰äº›ç±»ä¼¼ï¼Œä½†æ›´åŠ çµæ´»å’Œå¼ºå¤§</p><p>åœ¨å®ç°åˆ†é¢æœç´¢ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¹ç´¢å¼•ç»“æ„è¿›è¡Œè°ƒæ•´ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -H<span class="string">'Content-Type: application/json'</span> -XPUT http://localhost:9200/test_index/_mapping -d<span class="string">'{</span></span><br><span class="line"><span class="string">  "properties": {</span></span><br><span class="line"><span class="string">    "title": { "type": "text", "analyzer": "ik_smart" }, </span></span><br><span class="line"><span class="string">    "description": { "type": "text", "analyzer": "ik_smart" },</span></span><br><span class="line"><span class="string">    "price": { "type": "scaled_float", "scaling_factor": 100 },</span></span><br><span class="line"><span class="string">    "properties": {</span></span><br><span class="line"><span class="string">      "type": "nested",</span></span><br><span class="line"><span class="string">      "properties": {</span></span><br><span class="line"><span class="string">        "name": { "type": "keyword" }, </span></span><br><span class="line"><span class="string">        "value": { "type": "keyword" }</span></span><br><span class="line"><span class="string">      }</span></span><br><span class="line"><span class="string">    }</span></span><br><span class="line"><span class="string">  }</span></span><br><span class="line"><span class="string">}'</span></span><br><span class="line">curl -H<span class="string">'Content-Type: application/json'</span> -XPUT http://localhost:9200/test_index/_doc/1 -d<span class="string">'{</span></span><br><span class="line"><span class="string">    "title": "iPhone XR",</span></span><br><span class="line"><span class="string">    "description": "å…¨æ–°å›½äº§",</span></span><br><span class="line"><span class="string">    "price": 12800,</span></span><br><span class="line"><span class="string">    "properties": [{</span></span><br><span class="line"><span class="string">        "name": "å“ç‰Œåç§°",</span></span><br><span class="line"><span class="string">        "value": "è‹¹æœ"</span></span><br><span class="line"><span class="string">    }, {</span></span><br><span class="line"><span class="string">        "name": "æœºèº«å†…å­˜",</span></span><br><span class="line"><span class="string">        "value": "256G"</span></span><br><span class="line"><span class="string">    }]</span></span><br><span class="line"><span class="string">}'</span></span><br><span class="line">curl -H<span class="string">'Content-Type: application/json'</span> -XPUT http://localhost:9200/test_index/_doc/2 -d<span class="string">'{</span></span><br><span class="line"><span class="string">    "title": "VIVO X3",</span></span><br><span class="line"><span class="string">    "description": "å…¨æ–°å›½äº§æ­£å“",</span></span><br><span class="line"><span class="string">    "price": 3600,</span></span><br><span class="line"><span class="string">    "properties": [{</span></span><br><span class="line"><span class="string">        "name": "å“ç‰Œåç§°",</span></span><br><span class="line"><span class="string">        "value": "VIVO"</span></span><br><span class="line"><span class="string">    }, {</span></span><br><span class="line"><span class="string">        "name": "æœºèº«å†…å­˜",</span></span><br><span class="line"><span class="string">        "value": "128G"</span></span><br><span class="line"><span class="string">    }]</span></span><br><span class="line"><span class="string">}'</span></span><br><span class="line">curl -H<span class="string">'Content-Type: application/json'</span> -XPUT http://localhost:9200/test_index/_doc/3 -d<span class="string">'{</span></span><br><span class="line"><span class="string">    "title": "iPhone 13 PLUS",</span></span><br><span class="line"><span class="string">    "description": "å…¨æ–°å›½è¡Œ",</span></span><br><span class="line"><span class="string">    "price": 9800,</span></span><br><span class="line"><span class="string">    "properties": [{</span></span><br><span class="line"><span class="string">        "name": "å“ç‰Œåç§°",</span></span><br><span class="line"><span class="string">        "value": "è‹¹æœ"</span></span><br><span class="line"><span class="string">    }, {</span></span><br><span class="line"><span class="string">        "name": "æœºèº«å†…å­˜",</span></span><br><span class="line"><span class="string">        "value": "520G"</span></span><br><span class="line"><span class="string">    }]</span></span><br><span class="line"><span class="string">}'</span></span><br></pre></td></tr></tbody></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨ <code>test_index</code> ç´¢å¼•æ–°å¢äº†ä¸€ä¸ª <code>properties</code> å­—æ®µç”¨äºå‚¨å­˜å•†å“å±æ€§ï¼Œå¹¶æ’å…¥äº†ä¸‰æ¡æµ‹è¯•æ–‡æ¡£ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•è¿›è¡Œæœç´¢ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -XPOST -H<span class="string">'Content-Type:application/json'</span> http://localhost:9200/test_index/_search?pretty -d<span class="string">'</span></span><br><span class="line"><span class="string">{</span></span><br><span class="line"><span class="string">	"from": 0,</span></span><br><span class="line"><span class="string">	"size": 10,</span></span><br><span class="line"><span class="string">	"sort": [{</span></span><br><span class="line"><span class="string">		"price": "desc"</span></span><br><span class="line"><span class="string">	}],</span></span><br><span class="line"><span class="string">	"query": {</span></span><br><span class="line"><span class="string">		"bool": {</span></span><br><span class="line"><span class="string">			"must": [{</span></span><br><span class="line"><span class="string">				"multi_match": {</span></span><br><span class="line"><span class="string">					"query": "å…¨æ–°",</span></span><br><span class="line"><span class="string">					"fields": ["title^2", "description"]</span></span><br><span class="line"><span class="string">				}</span></span><br><span class="line"><span class="string">			}]</span></span><br><span class="line"><span class="string">		}</span></span><br><span class="line"><span class="string">	},</span></span><br><span class="line"><span class="string">	"aggs": {</span></span><br><span class="line"><span class="string">		"properties": {</span></span><br><span class="line"><span class="string">			"nested": {</span></span><br><span class="line"><span class="string">				"path": "properties"</span></span><br><span class="line"><span class="string">			},</span></span><br><span class="line"><span class="string">			"aggs": {</span></span><br><span class="line"><span class="string">				"properties": {</span></span><br><span class="line"><span class="string">					"terms": {</span></span><br><span class="line"><span class="string">						"field": "properties.name"</span></span><br><span class="line"><span class="string">					}</span></span><br><span class="line"><span class="string">				}</span></span><br><span class="line"><span class="string">			}</span></span><br><span class="line"><span class="string">		}</span></span><br><span class="line"><span class="string">	}</span></span><br><span class="line"><span class="string">}'</span></span><br></pre></td></tr></tbody></table></figure><p>ä»¥ä¸Šæœç´¢æ¡ä»¶è¿”å›å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.codeover.cn/img/image-20220728231814918.png-imageFop" alt="è¿”å›ç¤ºä¾‹"></p><p>ä»¥ä¸‹ä¸ºå¯¹åº”å­—æ®µè§£é‡Š</p><figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">'aggs' =&gt; <span class="punctuation">[</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„ properties æ˜¯æˆ‘ä»¬ç»™è¿™ä¸ªèšåˆæ“ä½œçš„å‘½å</span></span><br><span class="line">    <span class="comment">// å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²ï¼Œä¸å•†å“ç»“æ„é‡Œçš„ properties æ²¡æœ‰å¿…ç„¶è”ç³»</span></span><br><span class="line">    'properties' =&gt; <span class="punctuation">[</span></span><br><span class="line">        <span class="comment">// ç”±äºæˆ‘ä»¬è¦èšåˆçš„å±æ€§æ˜¯åœ¨ nested ç±»å‹å­—æ®µä¸‹çš„å±æ€§ï¼Œéœ€è¦åœ¨å¤–é¢å¥—ä¸€å±‚ nested èšåˆæŸ¥è¯¢</span></span><br><span class="line">        'nested' =&gt; <span class="punctuation">[</span> </span><br><span class="line">            <span class="comment">// ä»£è¡¨æˆ‘ä»¬è¦æŸ¥è¯¢çš„ nested å­—æ®µåä¸º properties</span></span><br><span class="line">            'path' =&gt; 'properties'<span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// åœ¨ nested èšåˆä¸‹åµŒå¥—èšåˆ</span></span><br><span class="line">        'aggs'   =&gt; <span class="punctuation">[</span></span><br><span class="line">            <span class="comment">// èšåˆçš„åç§°</span></span><br><span class="line">            'properties' =&gt; <span class="punctuation">[</span></span><br><span class="line">                <span class="comment">// terms èšåˆï¼Œç”¨äºèšåˆç›¸åŒçš„å€¼</span></span><br><span class="line">                'terms' =&gt; <span class="punctuation">[</span></span><br><span class="line">                    <span class="comment">// æˆ‘ä»¬è¦èšåˆçš„å­—æ®µå</span></span><br><span class="line">                    'field' =&gt; 'properties.name'<span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></tbody></table></figure><p>è¿”å›ä¿¡æ¯è§£é‡Šï¼š</p><figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// èšåˆç»“æœ</span></span><br><span class="line"><span class="string">"aggregations"</span> =&gt; <span class="punctuation">[</span></span><br><span class="line">  <span class="comment">// ç¬¬ä¸€å±‚èšåˆçš„åç§°</span></span><br><span class="line">  <span class="string">"properties"</span> =&gt; <span class="punctuation">[</span></span><br><span class="line">    <span class="comment">// èšåˆäº† 6 ä¸ªæ–‡æ¡£ï¼Œå³æœç´¢ç»“æœä¸­å…±æœ‰ 6 ä¸ªå•†å“å±æ€§</span></span><br><span class="line">    <span class="string">"doc_count"</span> =&gt; <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// ç¬¬äºŒå±‚èšåˆçš„åç§°</span></span><br><span class="line">    <span class="string">"properties"</span> =&gt; <span class="punctuation">[</span></span><br><span class="line">      <span class="string">"doc_count_error_upper_bound"</span> =&gt; <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"sum_other_doc_count"</span> =&gt; <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// ç¬¬äºŒå±‚èšåˆç»“æœ</span></span><br><span class="line">      <span class="string">"buckets"</span> =&gt; <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">[</span></span><br><span class="line">          <span class="comment">// properties.name ä¸ºã€å“ç‰Œåç§°ã€çš„å±æ€§å…±æœ‰ 3 ä¸ª</span></span><br><span class="line">          <span class="string">"key"</span> =&gt; <span class="string">"å“ç‰Œåç§°"</span><span class="punctuation">,</span> </span><br><span class="line">          <span class="string">"doc_count"</span> =&gt; <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">[</span></span><br><span class="line">          <span class="string">"key"</span> =&gt; <span class="string">"æœºèº«å†…å­˜"</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">"doc_count"</span> =&gt; <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></tbody></table></figure><p>è§£å†³ä¸‹æˆ‘ä»¬è¿›è¡Œç¬¬ä¸‰å±‚èšåˆï¼Œä¹Ÿå°±æ˜¯å±æ€§å€¼çš„èšåˆ</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -XPOST -H<span class="string">'Content-Type:application/json'</span> http://localhost:9200/test_index/_search?pretty -d<span class="string">'</span></span><br><span class="line"><span class="string">{</span></span><br><span class="line"><span class="string">	"from": 0,</span></span><br><span class="line"><span class="string">	"size": 10,</span></span><br><span class="line"><span class="string">	"sort": [{</span></span><br><span class="line"><span class="string">		"price": "desc"</span></span><br><span class="line"><span class="string">	}],</span></span><br><span class="line"><span class="string">	"query": {</span></span><br><span class="line"><span class="string">		"bool": {</span></span><br><span class="line"><span class="string">			"must": [{</span></span><br><span class="line"><span class="string">				"multi_match": {</span></span><br><span class="line"><span class="string">					"query": "å…¨æ–°",</span></span><br><span class="line"><span class="string">					"fields": ["title^2", "description"]</span></span><br><span class="line"><span class="string">				}</span></span><br><span class="line"><span class="string">			}]</span></span><br><span class="line"><span class="string">		}</span></span><br><span class="line"><span class="string">	},</span></span><br><span class="line"><span class="string">	"aggs": {</span></span><br><span class="line"><span class="string">		"properties": {</span></span><br><span class="line"><span class="string">			"nested": {</span></span><br><span class="line"><span class="string">				"path": "properties"</span></span><br><span class="line"><span class="string">			},</span></span><br><span class="line"><span class="string">			"aggs": {</span></span><br><span class="line"><span class="string">				"properties": {</span></span><br><span class="line"><span class="string">					"terms": {</span></span><br><span class="line"><span class="string">						"field": "properties.name"</span></span><br><span class="line"><span class="string">					},</span></span><br><span class="line"><span class="string">					"aggs": {</span></span><br><span class="line"><span class="string">						"value": {</span></span><br><span class="line"><span class="string">							"terms": {</span></span><br><span class="line"><span class="string">								"field": "properties.value"</span></span><br><span class="line"><span class="string">							}</span></span><br><span class="line"><span class="string">						}</span></span><br><span class="line"><span class="string">					}</span></span><br><span class="line"><span class="string">				}</span></span><br><span class="line"><span class="string">			}</span></span><br><span class="line"><span class="string">		}</span></span><br><span class="line"><span class="string">	}</span></span><br><span class="line"><span class="string">}'</span></span><br></pre></td></tr></tbody></table></figure><p><img src="https://cdn.codeover.cn/img/image-20220728232629770.png-imageFop" alt="ç¬¬ä¸‰å±‚èšåˆ"></p><p>æ­¤æ—¶å¯ä»¥çœ‹åˆ°å‡ ä¹å·²å®ç°ç±»ä¼¼äºäº¬ä¸œåˆ†é¢æœç´¢çš„åŠŸèƒ½ã€‚</p><h2 id="åŒä¹‰è¯æœç´¢"><a href="#åŒä¹‰è¯æœç´¢" class="headerlink" title="åŒä¹‰è¯æœç´¢"></a>åŒä¹‰è¯æœç´¢</h2><p>åœ¨å‰é¢çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†åŸºæœ¬çš„æœç´¢ï¼ŒæŸä¸ªæ–‡æ¡£è¦æƒ³åœ¨æŸä¸ªå…³é”®è¯æœç´¢ç»“æœä¸­å‡ºç°ï¼Œå°±å¿…é¡»åœ¨æ–‡æ¡£å†…å®¹ä¸­å‡ºç°è¯¥å…³é”®è¯ï¼Œè¿™æ ·å°±éœ€è¦ç»™å•†å“é…ç½®å·¨é‡çš„å…³é”®è¯æ‰èƒ½è®©å•†å“å‡ºç°çš„é¢‘ç‡æé«˜ï¼Œ å¯¹è¿è¥ç®¡ç†äººå‘˜ä¸ç”šå‹å¥½ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦è®©æœç´¢å¼•æ“æ”¯æŒ <em>åŒä¹‰è¯æœç´¢</em>ï¼Œæ¯”å¦‚ç”¨æˆ·æœç´¢ã€Œè‹¹æœæ‰‹æœºã€ï¼Œé‚£ä¹ˆåŒ…å« ã€ŒIphoneã€ çš„æ–‡æ¡£ä¹Ÿä¼šå‡ºç°åœ¨æœç´¢ç»“æœä¸­ã€‚</p><p>ä½œä¸ºç›®å‰æœ€å¼ºå¤§çš„æœç´¢å¼•æ“ä¹‹ä¸€ï¼ŒElasticsearch æ˜¯é»˜è®¤æ”¯æŒ <em>åŒä¹‰è¯æœç´¢</em> çš„ã€‚</p><h3 id="åˆ†æå™¨"><a href="#åˆ†æå™¨" class="headerlink" title="åˆ†æå™¨"></a>åˆ†æå™¨</h3><p>Elasticsearch çš„åˆ†æå™¨æ˜¯ç”± ã€Œå­—ç¬¦è¿‡æ»¤å™¨ã€ã€ã€Œåˆ†è¯å™¨ã€ä¸ã€Œå­—ç¬¦è¿‡æ»¤å™¨ã€ä¸‰éƒ¨åˆ†ç»„æˆï¼ŒElasticsearch å†…ç½®äº†ä¸€äº› ã€Œåˆ†æå™¨ã€ï¼ŒåŒæ—¶ä¹Ÿå…è®¸æˆ‘ä»¬è‡ªè¡Œå®šä¹‰åˆ†æå™¨ã€‚</p><ul><li><strong>å­—ç¬¦è¿‡æ»¤å™¨</strong>ï¼šã€Œå­—ç¬¦è¿‡æ»¤å™¨ã€ä¼šä»¥å­—ç¬¦ä¸ºå•ä½ï¼Œæ ¹æ®ä¸€å®šçš„è§„åˆ™å»æ·»åŠ ã€åˆ é™¤ã€æ›¿æ¢åŸå§‹å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚å°†æ±‰å­—çš„ ã€Œä¸€äºŒä¸‰å››ã€æ›¿æ¢æˆé˜¿æ‹‰ä¼¯æ•°å­—ã€Œ1234ã€ï¼Œä¸€ä¸ªã€Œåˆ†æå™¨ã€å¯ä»¥åŒ…å« 0 ä¸ªæˆ–å¤šä¸ªã€Œå­—ç¬¦è¿‡æ»¤å™¨ã€ã€‚</li><li><strong>åˆ†è¯å™¨</strong>ï¼šã€Œåˆ†è¯å™¨ã€æ˜¯æ ¹æ®ä¸€å®šçš„è§„åˆ™ï¼Œå°†åŸå§‹å­—ç¬¦ä¸²æ‹†åˆ†æˆä¸€ç»„ç»„çš„è¯è¯­ï¼Œæ¯”å¦‚å‰æ–‡ä»‹ç»çš„ <code>ik_smart</code> åˆ†è¯å™¨ï¼Œå…¶å¯ä»¥å°†ã€Œè‹¹æœæ‰‹æœºã€æ‹†åˆ†æˆã€Œè‹¹æœã€å’Œã€Œæ‰‹æœºã€ä¸¤ä¸ªè¯è¯­ï¼Œä¸€ä¸ªã€Œåˆ†æå™¨ã€æœ‰ä¸”ä»…èƒ½æœ‰ä¸€ä¸ªã€Œåˆ†è¯å™¨ã€ã€‚</li><li><strong>è¯è¯­è¿‡æ»¤å™¨</strong>ï¼šã€Œè¯è¯­è¿‡æ»¤å™¨ã€ä¼šæ ¹æ®ã€Œåˆ†è¯å™¨ã€çš„åˆ†è¯ç»“æœï¼Œä»¥è¯è¯­ä¸ºå•ä½ï¼Œæ ¹æ®ä¸€å®šçš„è§„åˆ™å»æ·»åŠ ã€åˆ é™¤ã€æ›¿æ¢è¯å¥ï¼Œä¾‹å¦‚åŒä¹‰è¯è¿‡æ»¤å™¨ <code>synonym</code> å¯ä»¥å°†ã€Œè¥¿çº¢æŸ¿ã€æ›¿æ¢ä¸º ã€Œè¥¿çº¢æŸ¿ã€+ã€Œç•ªèŒ„ã€ä¸¤ä¸ªè¯ï¼Œä¸€ä¸ªã€Œåˆ†æå™¨ã€å¯ä»¥åŒ…å« 0 ä¸ªæˆ–å¤šä¸ªã€Œè¯è¯­è¿‡æ»¤å™¨ã€ã€‚</li></ul><h3 id="è‡ªå®šä¹‰åˆ†æå™¨"><a href="#è‡ªå®šä¹‰åˆ†æå™¨" class="headerlink" title="è‡ªå®šä¹‰åˆ†æå™¨"></a>è‡ªå®šä¹‰åˆ†æå™¨</h3><p>é¦–å…ˆæˆ‘ä»¬å…ˆåˆ›å»ºåŒä¹‰è¯å¯¹åº”å…³ç³»çš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ ¼å¼å½¢å¦‚ <code>iPhone,è‹¹æœæ‰‹æœº =&gt; iPhone,è‹¹æœæ‰‹æœº</code>ï¼Œæ¯è¡Œä¸€ç»„å…³é”®è¯ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /www/server/elasticsearch/config/</span><br><span class="line"><span class="built_in">mkdir</span> analysis</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"iPhone,è‹¹æœæ‰‹æœº =&gt; iPhone,è‹¹æœæ‰‹æœº"</span> &gt; analysis/synonyms.txt</span><br></pre></td></tr></tbody></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰åˆ†æå™¨ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•æ¥æµ‹è¯•ï¼ŒElasticsearch æ”¯æŒåœ¨åˆ›å»ºç´¢å¼•çš„åŒæ—¶åˆ›å»ºã€Œåˆ†æå™¨ã€ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -XPUT -H<span class="string">'Content-Type: application/json'</span> http://localhost:9200/test_synonym?pretty -d<span class="string">' </span></span><br><span class="line"><span class="string">{</span></span><br><span class="line"><span class="string">  "settings": {</span></span><br><span class="line"><span class="string">    "index": {</span></span><br><span class="line"><span class="string">      "analysis": {</span></span><br><span class="line"><span class="string">        "filter": {</span></span><br><span class="line"><span class="string">          "synonym_filter": {</span></span><br><span class="line"><span class="string">            "type": "synonym",</span></span><br><span class="line"><span class="string">            "synonyms_path": "analysis/synonyms.txt",</span></span><br><span class="line"><span class="string">            "updateable":  true</span></span><br><span class="line"><span class="string">          }</span></span><br><span class="line"><span class="string">        },</span></span><br><span class="line"><span class="string">        "analyzer": {</span></span><br><span class="line"><span class="string">          "ik_smart_synonym": {</span></span><br><span class="line"><span class="string">            "type": "custom",</span></span><br><span class="line"><span class="string">            "tokenizer": "ik_smart",</span></span><br><span class="line"><span class="string">            "filter": ["synonym_filter"]</span></span><br><span class="line"><span class="string">          }</span></span><br><span class="line"><span class="string">        }</span></span><br><span class="line"><span class="string">      }</span></span><br><span class="line"><span class="string">    }</span></span><br><span class="line"><span class="string">  }</span></span><br><span class="line"><span class="string">}'</span></span><br></pre></td></tr></tbody></table></figure><p>åœ¨è¿™ä¸ªè¯·æ±‚ä¸­æˆ‘ä»¬åœ¨ <code>analysis</code> ä¸‹çš„ <code>filter</code> ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>synonym_filter</code> çš„ã€åŒä¹‰è¯è¯è¯­è¿‡æ»¤å™¨ã€ï¼Œå¹¶ä¸”æŒ‡å®šåŒä¹‰è¯çš„å­—å…¸è·¯å¾„ä¸º <code>analysis/synonyms.txt</code>ï¼›åŒæ—¶åœ¨ <code>analyzer</code> ä¸‹å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>ik_smart_synonym</code> çš„ã€Œè‡ªå®šä¹‰åˆ†æå™¨ã€ï¼Œå¹¶æŒ‡å®š <code>ik_smart</code> ä½œä¸ºã€Œåˆ†è¯å™¨ã€ï¼Œä¸Šé¢å®šä¹‰çš„ <code>synonym_filter</code> ä½œä¸ºã€Œè¯è¯­è¿‡æ»¤å™¨ã€ã€‚</p><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹è¿™ä¸ªåˆ†æå™¨çš„æ•ˆæœï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -H<span class="string">'Content-Type: application/json'</span> http://localhost:9200/test_synonym/_analyze?pretty -d <span class="string">'{"text": "è‹¹æœæ‰‹æœº","analyzer":"ik_smart_synonym"}'</span></span><br></pre></td></tr></tbody></table></figure><p>è¿”å›å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"tokens"</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"token"</span> <span class="punctuation">:</span> <span class="string">"iphone"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"start_offset"</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"end_offset"</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"type"</span> <span class="punctuation">:</span> <span class="string">"SYNONYM"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"position"</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"token"</span> <span class="punctuation">:</span> <span class="string">"è‹¹æœ"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"start_offset"</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"end_offset"</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"type"</span> <span class="punctuation">:</span> <span class="string">"SYNONYM"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"position"</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"token"</span> <span class="punctuation">:</span> <span class="string">"æ‰‹æœº"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"start_offset"</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"end_offset"</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"type"</span> <span class="punctuation">:</span> <span class="string">"SYNONYM"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"position"</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><p>å¯ä»¥çœ‹åˆ°ã€Œåˆ†æå™¨ã€å°†å…³é”®è¯ <code>è‹¹æœæ‰‹æœº</code> æ‹†åˆ†æˆä¸ºäº† <code>iphone</code> ã€ <code>è‹¹æœ</code> ä¸ <code>æ‰‹æœº</code> ä¸‰ä¸ªè¯ã€‚</p><h2 id="åœ¨-php-ä¸­ä½¿ç”¨-Elasticsearch"><a href="#åœ¨-php-ä¸­ä½¿ç”¨-Elasticsearch" class="headerlink" title="åœ¨ php ä¸­ä½¿ç”¨ Elasticsearch"></a>åœ¨ php ä¸­ä½¿ç”¨ Elasticsearch</h2><ol><li>å¼•å…¥ Composer åŒ…</li></ol><p>Elasticsearch å®˜æ–¹æä¾›äº† Composer åŒ…ï¼Œå› ä¸ºä¸åŒç‰ˆæœ¬çš„ Elasticsearch çš„ API ç•¥æœ‰ä¸åŒï¼Œæ‰€ä»¥åœ¨å¼•å…¥æ—¶éœ€è¦æ³¨æ„è¦æŒ‡å®šç‰ˆæœ¬ï¼Œä¾‹å¦‚å¼•å…¥ <code>8.x</code> ç‰ˆæœ¬ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">composer require elasticsearch/elasticsearch <span class="string">'^7.0'</span></span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>å®ä¾‹åŒ– Elasticsearch å®ä¾‹</li></ol><figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="variable">$builder</span> = <span class="title class_">Elastic\Elasticsearch\ClientBuilder</span>::<span class="title function_ invoke__">create</span>()-&gt;<span class="title function_ invoke__">setHosts</span>([<span class="string">'localhost:9200'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$client</span> = <span class="variable">$builder</span>-&gt;<span class="title function_ invoke__">build</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å– test_index ç´¢å¼•ä¸­ ID ä¸º 1 çš„æ–‡æ¡£</span></span><br><span class="line"><span class="variable">$client</span>-&gt;<span class="title function_ invoke__">get</span>([<span class="string">'index'</span> =&gt; <span class="string">'test_index'</span>, <span class="string">'id'</span> =&gt; <span class="number">1</span>]);</span><br></pre></td></tr></tbody></table></figure><p>SDK è¯¦ç»†ä½¿ç”¨è¯´æ˜å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/cn/elasticsearch/php/current/_quickstart.html">https://www.elastic.co/guide/cn/elasticsearch/php/current/_quickstart.html</a></p><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none;padding-left:0;margin-left:40px"><li id="fn:1"><span style="display:inline-block;vertical-align:top;padding-right:10px;margin-left:-40px">1.</span><span style="display:inline-block;vertical-align:top;margin-left:10px">JDK å…¨ç§° <strong>Java Development Kit</strong>ã€‚å®ƒæ˜¯ Java è¯­è¨€çš„è½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼Œä¸»è¦ç”¨äºç§»åŠ¨è®¾å¤‡ã€åµŒå…¥å¼è®¾å¤‡ä¸Šçš„ java åº”ç”¨ç¨‹åºã€‚JDK æ˜¯æ•´ä¸ª java å¼€å‘çš„æ ¸å¿ƒï¼Œå®ƒåŒ…å«äº† JAVA çš„è¿è¡Œç¯å¢ƒï¼ˆJVM+Java ç³»ç»Ÿç±»åº“ï¼‰å’Œ JAVA å·¥å…·ã€‚ <a href="#fnref:1" rev="footnote">â†©</a></span></li><li id="fn:2"><span style="display:inline-block;vertical-align:top;padding-right:10px;margin-left:-40px">2.</span><span style="display:inline-block;vertical-align:top;margin-left:10px">x-pack æ˜¯ elasticsearch çš„ä¸€ä¸ªæ‰©å±•åŒ…ï¼Œé›†å®‰å…¨ï¼Œè­¦å‘Šï¼Œç›‘è§†ï¼Œå›¾å½¢å’ŒæŠ¥å‘ŠåŠŸèƒ½äºä¸€ä½“ï¼Œå¯ä»¥è½»æ¾çš„å¯ç”¨æˆ–è€…å…³é—­ä¸€äº›åŠŸèƒ½ã€‚ <a href="#fnref:2" rev="footnote">â†©</a></span></li></ol></div></div></div><div class="top-div"><ol class="top-box"><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E5%AE%89%E8%A3%85"><span class="top-box-text">å®‰è£…</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%AE%89%E8%A3%85-JDK"><span class="top-box-text">å®‰è£… JDK</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E4%B8%8B%E8%BD%BD%E5%B9%B6%E5%AE%89%E8%A3%85-Elasticsearch"><span class="top-box-text">ä¸‹è½½å¹¶å®‰è£… Elasticsearch</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E8%BF%90%E8%A1%8C"><span class="top-box-text">è¿è¡Œ</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E8%BF%9E%E6%8E%A5%E6%B5%8B%E8%AF%95"><span class="top-box-text">è¿æ¥æµ‹è¯•</span></a></li></ol></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="top-box-text">åŸºç¡€æ¦‚å¿µ</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C"><span class="top-box-text">åŸºç¡€æ“ä½œ</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#Elasticsearch-%E6%9F%A5%E8%AF%A2"><span class="top-box-text">Elasticsearch æŸ¥è¯¢</span></a></li></ol></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D"><span class="top-box-text">ä¸­æ–‡åˆ†è¯</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E5%88%86%E9%9D%A2%E6%90%9C%E7%B4%A2"><span class="top-box-text">åˆ†é¢æœç´¢</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E5%90%8C%E4%B9%89%E8%AF%8D%E6%90%9C%E7%B4%A2"><span class="top-box-text">åŒä¹‰è¯æœç´¢</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%88%86%E6%9E%90%E5%99%A8"><span class="top-box-text">åˆ†æå™¨</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E6%9E%90%E5%99%A8"><span class="top-box-text">è‡ªå®šä¹‰åˆ†æå™¨</span></a></li></ol></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E5%9C%A8-php-%E4%B8%AD%E4%BD%BF%E7%94%A8-Elasticsearch"><span class="top-box-text">åœ¨ php ä¸­ä½¿ç”¨ Elasticsearch</span></a></li></ol></div></div></div><div class="next-post"><a class="purple-link" href="/laravel-admin-lang/"><h3 class="post-title"> ä¸‹ä¸€ç¯‡ï¼šlaravel-admin æ ¹æ®è·¯ç”±è‡ªåŠ¨åˆ‡æ¢è¯­è¨€åŒ…</h3></a></div></div><div id="gitalk-container"></div><footer><div class="site-footer"><div class="social-container"><a href="https://github.com/f-dong" target="_blank"><i class="icon icon-github"></i></a></div> Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <a href="https://github.com/f-dong/hexo-theme-minimalism" target="_blank">Theme</a> | <a class="icp" href="https://beian.miit.gov.cn" target="_blank">è±«ICPå¤‡2022011962å·</a> | <a class="icp" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41010402002848" target="_blank">è±«å…¬ç½‘å®‰å¤‡41010402002848å·</a></div></footer></div><script src="/js/jquery.min.js"></script><script src="/js/jquery.fancybox.min.js"></script><script src="/js/main.js"></script><script src="/js/gitalk.min.js"></script><script>var gitalk=new Gitalk({clientID:"eaa8ec37487184406145",clientSecret:"77f9955d0267c1331df7cc706cfa385d2befb9c6",repo:"blog",owner:"f-dong",admin:["f-dong"],id:location.pathname.slice(1,location.pathname.lastIndexOf("/")).substring(0,49),distractionFreeMode:!1,createIssueManually:!0});gitalk.render("gitalk-container")</script></body></html>